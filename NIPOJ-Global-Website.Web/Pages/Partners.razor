@page "/partners"

<PageTitle>Partners</PageTitle>

@if (content is null || assetManifest is null)
{
    <p class="text-muted">Loading content...</p>
}
else
{
    <section class="partners-hero">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-8">
                    <h1 class="display-5 fw-bold mb-3">Technical Partners</h1>
                    <div class="section-divider"></div>
                    <p class="lead text-muted mb-0" style="max-width: 760px;">Delivering local depth and international reach across energy, maritime, and power infrastructure.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="kpi-strip">
        <div class="container">
            <div class="row text-center g-4">
                <div class="col-12 col-md-4">
                    <p class="text-uppercase small mb-1" style="letter-spacing: 0.12em; color: var(--brand-steel);">Partners</p>
                    <h2 class="fw-bold mb-0">@PartnerCount</h2>
                </div>
                <div class="col-12 col-md-4">
                    <p class="text-uppercase small mb-1" style="letter-spacing: 0.12em; color: var(--brand-steel);">Countries</p>
                    <h2 class="fw-bold mb-0">@CountryCount</h2>
                </div>
                <div class="col-12 col-md-4">
                    <p class="text-uppercase small mb-1" style="letter-spacing: 0.12em; color: var(--brand-steel);">Coverage</p>
                    <h2 class="fw-bold mb-0">Local + International</h2>
                </div>
            </div>
        </div>
    </section>

    <section class="page-section">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-4">
                <div>
                    <h2 class="h3 fw-bold mb-2">Global Partner Network</h2>
                    <p class="text-muted mb-0">Strategic alliances supporting project delivery, compliance, and operational excellence.</p>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                @foreach (var partner in content.TechnicalPartners)
                {
                    <div class="col">
                        <div class="partner-card border rounded p-4 h-100 bg-white">
                            <h3 class="h5 fw-bold mb-2">@partner.Name</h3>
                            <span class="badge bg-primary mb-3">@partner.Location</span>
                            <p class="text-muted mb-0">Strategic Partner</p>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>

    <section class="page-section" style="background-color: rgba(12, 35, 64, 0.02);">
        <div class="container">
            <div class="row g-5 align-items-start">
                <div class="col-12 col-lg-5">
                    <h2 class="h3 fw-bold mb-3">Certifications</h2>
                    <div class="section-divider"></div>
                    <p class="text-muted mb-0">Our certifications demonstrate compliance with critical regulatory agencies and the operational standards demanded by international energy partners.</p>
                </div>
                <div class="col-12 col-lg-7">
                    <ul class="list-unstyled mb-0" style="line-height: 2;">
                        @foreach (var certification in content.Certifications)
                        {
                            <li class="text-muted">@certification</li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section class="page-section">
        <div class="container">
            <div class="border rounded p-4 p-lg-5 bg-white shadow-sm">
                <h2 class="h3 fw-bold mb-3">Partnership Approach</h2>
                <div class="section-divider"></div>
                <p class="lead text-muted mb-0" style="line-height: 1.8;">@content.PartnershipsText</p>
            </div>
        </div>
    </section>
}

@code {
    [Inject]
    public ContentService ContentService { get; set; } = default!;

    [Inject]
    public AssetManifestService AssetManifestService { get; set; } = default!;

    private SiteContent? content;
    private AssetManifest? assetManifest;
    private int PartnerCount => content?.TechnicalPartners.Count ?? 0;
    private int CountryCount => content?.TechnicalPartners
        .Select(partner => GetCountry(partner.Location))
        .Where(country => !string.IsNullOrWhiteSpace(country))
        .Distinct(StringComparer.OrdinalIgnoreCase)
        .Count() ?? 0;

    protected override async Task OnInitializedAsync()
    {
        var contentTask = ContentService.GetContentAsync();
        var manifestTask = AssetManifestService.GetManifestAsync();
        await Task.WhenAll(contentTask, manifestTask);
        content = contentTask.Result;
        assetManifest = manifestTask.Result;
    }

    private static string GetCountry(string location)
    {
        if (string.IsNullOrWhiteSpace(location))
        {
            return string.Empty;
        }

        var parts = location.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
        return parts.Length > 0 ? parts[^1] : location.Trim();
    }
}
