@page "/contact"
@using System.ComponentModel.DataAnnotations

<PageTitle>Contact</PageTitle>

@if (content is null)
{
    <p class="text-muted">Loading content...</p>
}
else
{
    <div class="page-hero">
        <div class="container">
            <h1 class="fw-bold mb-3">Contact</h1>
            <div class="section-divider"></div>
            <p class="lead text-muted mb-0" style="max-width: 700px;">@content.Tagline</p>
        </div>
    </div>

    <section class="page-section">
        <div class="container">
            <div class="row g-5">
                <div class="col-12 col-lg-5">
                    <div class="border rounded p-4 h-100 bg-white shadow">
                        <h2 class="h5 fw-bold mb-4">Contact Details</h2>
                        <dl class="mb-0">
                            <dt class="text-uppercase small fw-semibold mb-2" style="color: var(--brand-steel); letter-spacing: 0.05em;">Address</dt>
                            <dd class="mb-4 lead" style="font-size: 1rem; line-height: 1.6;">@content.Contact.Address</dd>
                            <dt class="text-uppercase small fw-semibold mb-2" style="color: var(--brand-steel); letter-spacing: 0.05em;">Email</dt>
                            <dd class="mb-4">
                                <a href="mailto:@content.Contact.Email" class="text-decoration-none" style="color: var(--brand-gold); font-weight: 500;">@content.Contact.Email</a>
                            </dd>
                            <dt class="text-uppercase small fw-semibold mb-2" style="color: var(--brand-steel); letter-spacing: 0.05em;">Phone</dt>
                            <dd class="mb-4">@PhoneSummary</dd>
                            <dt class="text-uppercase small fw-semibold mb-2" style="color: var(--brand-steel); letter-spacing: 0.05em;">Website</dt>
                            <dd class="mb-0">
                                <a href="https://@content.Contact.Website" target="_blank" class="text-decoration-none" style="color: var(--brand-gold); font-weight: 500;">@content.Contact.Website</a>
                            </dd>
                        </dl>
                    </div>
                </div>
                <div class="col-12 col-lg-7">
                    <div class="border rounded p-4 h-100 bg-white shadow">
                        <h2 class="h5 fw-bold mb-4">Send a Message</h2>
                        <EditForm Model="formModel" OnValidSubmit="HandleValidSubmit">
                            <DataAnnotationsValidator />
                            <ValidationSummary class="text-danger mb-3" />
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-semibold" for="contactName">Name</label>
                                    <InputText id="contactName" class="form-control" @bind-Value="formModel.Name" placeholder="Your full name" />
                                    <ValidationMessage For="() => formModel.Name" class="text-danger small" />
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label fw-semibold" for="contactEmail">Email</label>
                                    <InputText id="contactEmail" class="form-control" @bind-Value="formModel.Email" placeholder="your@email.com" />
                                    <ValidationMessage For="() => formModel.Email" class="text-danger small" />
                                </div>
                                <div class="col-12 col-md-6">
                                    <label class="form-label fw-semibold" for="contactPhone">Phone</label>
                                    <InputText id="contactPhone" class="form-control" @bind-Value="formModel.Phone" placeholder="+234 800 000 0000" />
                                    <ValidationMessage For="() => formModel.Phone" class="text-danger small" />
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-semibold" for="contactMessage">Message</label>
                                    <InputTextArea id="contactMessage" class="form-control" rows="6" @bind-Value="formModel.Message" placeholder="How can we help you?" />
                                    <ValidationMessage For="() => formModel.Message" class="text-danger small" />
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary btn-lg">Send Message</button>
                                </div>
                            </div>
                        </EditForm>
                    </div>
                </div>
            </div>
        </div>
    </section>
}

@code {
    [Inject]
    public ContentService ContentService { get; set; } = default!;

    [Inject]
    public NavigationManager NavigationManager { get; set; } = default!;

    private SiteContent? content;
    private readonly ContactFormModel formModel = new();
    private string PhoneSummary => content is null ? string.Empty : string.Join(" | ", new[] { content.Contact.Phone1, content.Contact.Phone2 }.Where(value => !string.IsNullOrWhiteSpace(value)));

    protected override async Task OnInitializedAsync()
    {
        content = await ContentService.GetContentAsync();
    }

    private void HandleValidSubmit()
    {
        var body = $"Name: {formModel.Name}\nEmail: {formModel.Email}\nPhone: {formModel.Phone}\n\nMessage:\n{formModel.Message}";
        var recipient = content?.Contact.Email ?? string.Empty;
        var mailto = $"mailto:{recipient}?subject={Uri.EscapeDataString("Website Inquiry")}&body={Uri.EscapeDataString(body)}";
        NavigationManager.NavigateTo(mailto, true);
    }

    private class ContactFormModel
    {
        [Required]
        public string Name { get; set; } = string.Empty;

        [Required]
        [EmailAddress]
        public string Email { get; set; } = string.Empty;

        [Required]
        public string Phone { get; set; } = string.Empty;

        [Required]
        public string Message { get; set; } = string.Empty;
    }
}
