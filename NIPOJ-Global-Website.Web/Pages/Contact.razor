@page "/contact"
@using System.ComponentModel.DataAnnotations

<PageTitle>Contact</PageTitle>

@if (content is null)
{
    <p class="text-muted">Loading content...</p>
}
else
{
    <div class="page-hero">
        <h1 class="display-6 fw-semibold">Contact</h1>
        <p class="text-muted mb-0">@content.Tagline</p>
    </div>

    <div class="row g-4">
        <div class="col-12 col-lg-5">
            <div class="border rounded-3 p-4 h-100 bg-white shadow-sm">
                <h2 class="h5 text-uppercase text-primary">Contact Details</h2>
                <dl class="mt-3 mb-0">
                    <dt class="text-muted small text-uppercase">Address</dt>
                    <dd class="mb-3">@content.Contact.Address</dd>
                    <dt class="text-muted small text-uppercase">Email</dt>
                    <dd class="mb-3">@content.Contact.Email</dd>
                    <dt class="text-muted small text-uppercase">Phone</dt>
                    <dd class="mb-3">@PhoneSummary</dd>
                    <dt class="text-muted small text-uppercase">Website</dt>
                    <dd class="mb-0">@content.Contact.Website</dd>
                </dl>
            </div>
        </div>
        <div class="col-12 col-lg-7">
            <div class="border rounded-3 p-4 h-100 bg-white shadow-sm">
                <h2 class="h5 text-uppercase text-primary">Send a Message</h2>
                <EditForm Model="formModel" OnValidSubmit="HandleValidSubmit" class="mt-3">
                    <DataAnnotationsValidator />
                    <ValidationSummary class="text-danger" />
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label" for="contactName">Name</label>
                            <InputText id="contactName" class="form-control" @bind-Value="formModel.Name" />
                            <ValidationMessage For="() => formModel.Name" />
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label" for="contactEmail">Email</label>
                            <InputText id="contactEmail" class="form-control" @bind-Value="formModel.Email" />
                            <ValidationMessage For="() => formModel.Email" />
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label" for="contactPhone">Phone</label>
                            <InputText id="contactPhone" class="form-control" @bind-Value="formModel.Phone" />
                            <ValidationMessage For="() => formModel.Phone" />
                        </div>
                        <div class="col-12">
                            <label class="form-label" for="contactMessage">Message</label>
                            <InputTextArea id="contactMessage" class="form-control" rows="5" @bind-Value="formModel.Message" />
                            <ValidationMessage For="() => formModel.Message" />
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">Send Message</button>
                        </div>
                    </div>
                </EditForm>
            </div>
        </div>
    </div>
}

@code {
    [Inject]
    public ContentService ContentService { get; set; } = default!;

    [Inject]
    public NavigationManager NavigationManager { get; set; } = default!;

    private SiteContent? content;
    private readonly ContactFormModel formModel = new();
    private string PhoneSummary => content is null ? string.Empty : string.Join(" | ", new[] { content.Contact.Phone1, content.Contact.Phone2 }.Where(value => !string.IsNullOrWhiteSpace(value)));

    protected override async Task OnInitializedAsync()
    {
        content = await ContentService.GetContentAsync();
    }

    private void HandleValidSubmit()
    {
        var body = $"Name: {formModel.Name}\nEmail: {formModel.Email}\nPhone: {formModel.Phone}\n\nMessage:\n{formModel.Message}";
        var mailto = $"mailto:info@nipojglobalservices.com?subject={Uri.EscapeDataString("Website Inquiry")}&body={Uri.EscapeDataString(body)}";
        NavigationManager.NavigateTo(mailto, true);
    }

    private class ContactFormModel
    {
        [Required]
        public string Name { get; set; } = string.Empty;

        [Required]
        [EmailAddress]
        public string Email { get; set; } = string.Empty;

        [Required]
        public string Phone { get; set; } = string.Empty;

        [Required]
        public string Message { get; set; } = string.Empty;
    }
}
